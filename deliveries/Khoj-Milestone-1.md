# Milestone Delivery ðŸ“¬

**The delivery is according to the official [milestone delivery guidelines](https://github.com/Polkadot-Fast-Grants/delivery/blob/master/delivery-guidelines.md).**  

* **Application Document:** https://github.com/Polkadot-Fast-Grants/apply/pull/61 
* **Milestone Number:** 1
* **DOT Payment Address:** 15oe4E5PbPGM2zqDcEv9d7thAig74MfVF5iax2P7SofFbKac (Polkadot Asset Hub)

**Context** (optional)


The main aim of this milestone was to iron out the basic functionalities of the application and team playing feature. Detailed deliverables are listed in the application as well as in the next section here.

Latest version of the application is **deployed live** on [khoj-alpha.netlify.app](https://khoj-alpha.netlify.app/). 


Some important considerations:
1. We have currently deployed it on Moonbase Alpha due to two reasons:
  i. Our team joining [logic](https://github.com/ayush4345/Khoj/blob/main/contracts/src/Khoj.sol#L248-L286) requires the [ecrecover](https://github.com/ayush4345/Khoj/blob/main/contracts/src/Khoj.sol#L242) precomplile. This is not yet available on Passet Hub. However the code is present [here](https://github.com/paritytech/polkadot-sdk/blob/136b4cb5f52515ec8086ab4466226d48e8ba220b/substrate/frame/revive/src/precompiles/builtin/ecrecover.rs#L26). If you could help us with the same, it would be great and our longer goal is to stick to Passet Hub.
  ii. Passet Hub is unstable. We faced several issues during our testing. Until its stable, we decided to deploy to Moonbase Alpha so that we can continue.
2. Moonbase Alpha Dev tokens can be obtained from [here](https://faucet.moonbeam.network/ ).

Instructions to test are mentioned below. We would love to hear any feedback!


**Deliverables**

| Number | Deliverable | Link | Notes |
| ------------- | ------------- | ------------- |------------- |
| 0a. | License |[61c246fa3e04707be1c3c7a423677dc39d8cc85a](https://github.com/ayush4345/Khoj/commit/61c246fa3e04707be1c3c7a423677dc39d8cc85a)| | 
| 0b.  | Documentation | [Khoj/wiki](https://github.com/ayush4345/Khoj/wiki) | All the relevant documentation is available in the Khok Wiki. | 
| 0c.  | Testing and Testing Guide | [Product Guide](https://github.com/ayush4345/Khoj/wiki/Product-Guide)| | 
| 0d.  | Article | WIP | WIP | 
| 1.  | Replace Coinbase CDP with Reown Kit	 | [9467a663ebe3f8d55095d0c2764abde3f83ee46a](https://github.com/ayush4345/Khoj/commit/9467a663ebe3f8d55095d0c2764abde3f83ee46a) | After careful consideration, ease of integration and compatibility with PassetHub, we decided to use the [ThirdWeb Wallet](https://thirdweb.com/wallets) instead. We created a custom chain configuration for PassetHub and now support seamless Web2 native onboarding. | 
| 2.  | Replace Walrus with IPFS/Crust		 |[30c8b913361346c80cb4aa156038ed6c53951679](https://github.com/ayush4345/Khoj/commit/30c8b913361346c80cb4aa156038ed6c53951679)| We moved to a simpler way of storage by using Pinata. All the requied hunt and clues metadata is now stored on IPFS. This also involved ironing out lots of minor bugs, data processing format issues. Pinata related functions used in [`pinata.js`](https://github.com/ayush4345/Khoj/commit/74fc665ba539528f1b1ec9c4bf6a5108c6522765#diff-6fd1b19c920aa3e0ee2a1ee39ea228762bd323335c022d6e34c5a7e9f0026f62) | 
| 3.  | Perplexity Sonar API	 | [2ae4358fd9cc23d65c1d8616ec650f6f29e82d0b](https://github.com/ayush4345/Khoj/commit/2ae4358fd9cc23d65c1d8616ec650f6f29e82d0b) | We revised this deliverable to instead use Google's Gemini 2.5 Flash Lite model. This is mainly due to the avaialbility of strucuted responses. Since we require the clues from the LLM in JSON format, it was becoming increasingly difficult to maintain consistency in the output generated by the LLM, breaking the clue generation process. Another reason is the cost-effective pricing of Gemini. With structured responses and a retrying mechanism, we are seeing much higher levels of consistency. We also added a theme field in the hunt creation page to help guide the LLM to generate thematic clues. | 
| 4.  | Improvements to location verification		 |[2b79c5e798649c62c8cad194958f6b00bb5d483a](https://github.com/ayush4345/Khoj/commit/2b79c5e798649c62c8cad194958f6b00bb5d483a)| Used the Haversine Distance formula to accurately calculate proximity with 1-10m accuracy. We also realised that mobile phones use the built-in GPS sensor even when accessed by web browsers, resulting in very high accuracy in the coordinates received. Since our PWA is targeted at mobile users, this works great. | 
| 5.  | Team based gameplays			 | [d70ed80798431db2dc21ccd96d5d70d87a97253b](https://github.com/ayush4345/Khoj/commit/d70ed80798431db2dc21ccd96d5d70d87a97253b) | This involed a major and rather underestimated effort. We desgined a new flow to support team creation and joining existing teams via an invite code, while keeping security and ease of use in mind. Hunts can now be played in teams while the hunt owner having the ability to switch off team support while designing the hunt. | 


**Additional Information**

Contract addresses:
- KhojNFT: [0x871e2B166a306f4657EbC842b52E8C2806cAa745](https://moonbase.moonscan.io/address/0x871e2B166a306f4657EbC842b52E8C2806cAa745#internaltx)
- Khoj: [0x9E7f33158e59FE51F7122EeD44542d2ef3320625](https://moonbase.moonscan.io/address/0x9E7f33158e59FE51F7122EeD44542d2ef3320625)
